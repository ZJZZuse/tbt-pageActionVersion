// Generated by CoffeeScript 1.10.0
(function() {
  var controllerMain, initView, main, preUrl;

  initView = function() {
    var controller;
    controller = controllerMain;
    myCommonUITools.addButton(function() {
      return $('.try-list .tb-trial-wd-item-trial');
    }, function() {
      return $(this).parent().remove();
    }, '删除');
    return myCommonUITools.addDefaultButton(function() {
      return $('.try-list');
    }, function() {
      return controller.doAction();
    }, "启动");
  };

  controllerMain = null;

  preUrl = 'first';

  main = function() {
    var acquireUrlsAction, controller, urlsAll;
    urlsAll = [];
    myChromePlugTools.onReceive("tbtMsg", function(obj, sender) {
      if (obj['isFinishedToday']) {
        return myCommonUITools.setTextDefault(obj['tip']);
      }
    });
    controllerMain = controller = new PageActionControllerZ;
    initView();
    acquireUrlsAction = new PageActionJQ;
    acquireUrlsAction.getElement = function() {
      return $('.try-list a.tb-trial-button');
    };
    acquireUrlsAction.fireActionCus = function(eles) {
      var ele, i, len, url, urls;
      urls = [];
      for (i = 0, len = eles.length; i < len; i++) {
        ele = eles[i];
        url = $(ele).attr('href');
        if (urlsAll.indexOf(url) !== -1) {
          continue;
        }
        urls.push(url);
        urlsAll.push(url);
      }
      return async.mapLimit(urls, 1, function(url, callback) {
        var w;
        w = open(url);
        return myCommonToolsZ.fireActionByCusCondition(function() {}, w.closed, function() {
          return callback(null, url);
        });
      }, function(err, result) {
        return controller.onFinished(result);
      });
    };
    controller.add(acquireUrlsAction);
    return myCommonToolsZ.fireActionByCusCondition(function() {
      var result, urlT;
      urlT = $('.try-list a.tb-trial-button:first').attr("href");
      result = urlT !== preUrl;
      if (result) {
        if (preUrl === 'first') {
          preUrl = urlT;
          return false;
        }
        preUrl = urlT;
      }
      return result;
    }, function() {
      return initView();
    }, false, 1000, 1000);
  };

  myCommonToolsZ.fireActionByCusCondition(function() {
    return $('.try-list .tb-trial-wd-item-trial');
  }, function() {
    return main();
  }, void 0, 1000, 1000);

}).call(this);

//# sourceMappingURL=main.js.map
